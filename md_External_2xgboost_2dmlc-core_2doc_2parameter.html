<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Medial Code Documentation: Parameter Structure for Machine Learning</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Medial Code Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Parameter Structure for Machine Learning</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>One of the most important ingredients of machine learning projects are the parameters. Parameters act as a way of communication between users and the library. In this article, we will introduce the parameter module of DMLC, a lightweight C++ module that is designed to support general machine learning libraries. It comes with the following nice properties:</p>
<ul>
<li>Easy declaration of typed fields, default values and constraints.</li>
<li>Auto checking of constraints and throw exceptions when constraint is not met.</li>
<li>Auto generation of human readable docstrings on parameters.</li>
<li>Serialization and de-serialization into JSON and <code>std::map&lt;std::string, std::string&gt;</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md137"></a>
Use Parameter Module</h1>
<h2><a class="anchor" id="autotoc_md138"></a>
Declare the Parameter</h2>
<p>In the dmlc parameter module, every parameter can be declared as a structure. This means you can easily access these fields as they normally are efficiently. For example, it is very common to write </p><div class="fragment"><div class="line"> ++</div>
<div class="line">weight -= param.learning_rate * gradient;</div>
</div><!-- fragment --><p>The only difference between a normal structure is that we will need to declare all the fields, as well as their default value and constraints. The following code gives an example of declaring parameter structure <code><a class="el" href="structMyParam.html">MyParam</a></code>.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dmlc-core_2include_2dmlc_2parameter_8h.html">dmlc/parameter.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// declare the parameter, normally put it in header file.</span></div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structMyParam.html">MyParam</a> : <span class="keyword">public</span> dmlc::Parameter&lt;MyParam&gt; {</div>
<div class="line">  <span class="keywordtype">float</span> learning_rate;</div>
<div class="line">  <span class="keywordtype">int</span> num_hidden;</div>
<div class="line">  <span class="keywordtype">int</span> activation;</div>
<div class="line">  std::string name;</div>
<div class="line">  <span class="comment">// declare parameters</span></div>
<div class="line">  DMLC_DECLARE_PARAMETER(<a class="code hl_struct" href="structMyParam.html">MyParam</a>) {</div>
<div class="line">    DMLC_DECLARE_FIELD(num_hidden).set_range(0, 1000)</div>
<div class="line">        .describe(<span class="stringliteral">&quot;Number of hidden unit in the fully connected layer.&quot;</span>);</div>
<div class="line">    DMLC_DECLARE_FIELD(learning_rate).set_default(0.01f)</div>
<div class="line">        .describe(<span class="stringliteral">&quot;Learning rate of SGD optimization.&quot;</span>);</div>
<div class="line">    DMLC_DECLARE_FIELD(activation).add_enum(<span class="stringliteral">&quot;relu&quot;</span>, 1).add_enum(<span class="stringliteral">&quot;sigmoid&quot;</span>, 2)</div>
<div class="line">        .describe(<span class="stringliteral">&quot;Activation function type.&quot;</span>);</div>
<div class="line">    DMLC_DECLARE_FIELD(name).set_default(<span class="stringliteral">&quot;layer&quot;</span>)</div>
<div class="line">        .describe(<span class="stringliteral">&quot;Name of the net.&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// register the parameter, this is normally in a cc file.</span></div>
<div class="line">DMLC_REGISTER_PARAMETER(<a class="code hl_struct" href="structMyParam.html">MyParam</a>);</div>
<div class="ttc" id="admlc-core_2include_2dmlc_2parameter_8h_html"><div class="ttname"><a href="dmlc-core_2include_2dmlc_2parameter_8h.html">parameter.h</a></div><div class="ttdoc">Provide lightweight util to do parameter setup and checking.</div></div>
<div class="ttc" id="astructMyParam_html"><div class="ttname"><a href="structMyParam.html">MyParam</a></div><div class="ttdef"><b>Definition</b> parameter.cc:13</div></div>
</div><!-- fragment --><p>We can find that the only difference is the lines after <code>DMLC_DECLARE_PARAMETER(MyParam)</code>, where all the fields are declared. In this example, we have declared parameters of <code>float,int,string</code> types. Here are some highlights in this example:</p>
<ul>
<li>For the numeric parameters, it is possible to set a range constraints via <code>.set_range(begin, end)</code>.</li>
<li>It is possible to define enumeration types, in this case activation. User is only allowed to set <code>sigmoid</code> or <code>relu</code> into the activation field, and they will be mapped into 1 and 2 separately.</li>
<li>The <code>describe</code> function adds a description on the field, which is used to generate human readable docstring.</li>
</ul>
<h2><a class="anchor" id="autotoc_md139"></a>
Set the Parameters</h2>
<p>After we declared the parameters, we can declare this structure as normal structure. Except that the <code><a class="el" href="structMyParam.html">MyParam</a></code> structure now comes with a few member functions to make parameter manipulation easy. To set the parameters from external data source, we can use the <code>Init</code> function. </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">   <a class="code hl_struct" href="structMyParam.html">MyParam</a> param;</div>
<div class="line">   std::vector&lt;std::pair&lt;std::string, std::string&gt; &gt; param_data = {</div>
<div class="line">     {<span class="stringliteral">&quot;num_hidden&quot;</span>, <span class="stringliteral">&quot;100&quot;</span>},</div>
<div class="line">     {<span class="stringliteral">&quot;activation&quot;</span>, <span class="stringliteral">&quot;relu&quot;</span>},</div>
<div class="line">     {<span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;myname&quot;</span>}</div>
<div class="line">   };</div>
<div class="line">   <span class="comment">// set the parameters</span></div>
<div class="line">   param.Init(param_data);</div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> After the <code>Init</code> function is called, the <code>param</code> will be filled with the specified key values in <code>param_data</code>. More importantly, the <code>Init</code> function will do automatic checking of parameter range and throw an <code>dmlc::ParamError</code> with detailed error message if things went wrong.</p>
<h2><a class="anchor" id="autotoc_md140"></a>
Generate Human Readable Docstrings</h2>
<p>Another useful feature of the parameter module is to get an human readable docstring of the parameter. This is helpful when we are creating language binding such as python and R, and we can use it to generate docstring of foreign language interface.</p>
<p>The following code obtains the dostring of <code><a class="el" href="structMyParam.html">MyParam</a></code>. </p><div class="fragment"><div class="line"> ++</div>
<div class="line">std::string docstring = MyParam::__DOC__();</div>
</div><!-- fragment --><p>We also provide a more structured way to access the detail of the fields(name, default value, detailed description) via </p><div class="fragment"><div class="line"> ++</div>
<div class="line">std::vector&lt;dmlc::ParamFieldInfo&gt; fields = MyParam::__FIELDS__();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md141"></a>
Serialization of Parameters</h2>
<p>One of the most common way to serialize the parameter is to convert it back to representation of <code>std::map&lt;string, string&gt;</code> by using the following code. </p><div class="fragment"><div class="line"> ++</div>
<div class="line">std::map&lt;string, string&gt; dict = param.__DICT__();</div>
</div><!-- fragment --><p> The <code>std::map&lt;string, string&gt;</code> can further be serialized easily. This way of serialization is more device and platform(32/64 bit) agnostic. However, this is not very compact, and recommended only used to serialize the general parameters set by the user.</p>
<p>Direct serialization and loading of JSON format is also support.</p>
<h2><a class="anchor" id="autotoc_md142"></a>
Play with an Example</h2>
<p>We provide an example program <a href="https://github.com/dmlc/dmlc-core/blob/main/example/parameter.cc">parameter.cc</a>, to demonstrate the usage mentioned above, and allow you to play with it and get sense of what is going on.</p>
<h1><a class="anchor" id="autotoc_md143"></a>
How does it work</h1>
<p>Hope you like the parameter module so far. In this section, we will explain how does it work. Making such parameter module in <code>C++</code> is not easy. Because this basically means some way of reflection &ndash; getting the information of fields in a structure out, which is not supported by <code>C++</code>.</p>
<p>Consider the following program, how do the Init function know the location of <code>num_hidden</code>, and set it correctly in <code>Init</code> function?</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dmlc-core_2include_2dmlc_2parameter_8h.html">dmlc/parameter.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// declare the parameter, normally put it in header file.</span></div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structMyParam.html">MyParam</a> : <span class="keyword">public</span> dmlc::Parameter&lt;MyParam&gt; {</div>
<div class="line">  <span class="keywordtype">float</span> learning_rate;</div>
<div class="line">  <span class="keywordtype">int</span> num_hidden;</div>
<div class="line">  <span class="comment">// declare parameters</span></div>
<div class="line">  DMLC_DECLARE_PARAMETER(<a class="code hl_struct" href="structMyParam.html">MyParam</a>) {</div>
<div class="line">    DMLC_DECLARE_FIELD(num_hidden);</div>
<div class="line">    DMLC_DECLARE_FIELD(learning_rate).set_default(0.01f);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// register the parameter, this is normally in a cc file.</span></div>
<div class="line">DMLC_REGISTER_PARAMETER(<a class="code hl_struct" href="structMyParam.html">MyParam</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line">  <a class="code hl_struct" href="structMyParam.html">MyParam</a> param;</div>
<div class="line">  std::vector&lt;std::pair&lt;std::string, std::string&gt; &gt; param_data = {</div>
<div class="line">    {<span class="stringliteral">&quot;num_hidden&quot;</span>, <span class="stringliteral">&quot;100&quot;</span>},</div>
<div class="line">  };</div>
<div class="line">  param.Init(param_data);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The secret lies in the function <code>DMLC_DECLARE_PARAMETER(MyParam)</code>, this is a macro defined in the parameter module. If we expand the macro, the code roughly becomes the following code.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">struct </span>Parameter&lt;<a class="code hl_struct" href="structMyParam.html">MyParam</a>&gt; {</div>
<div class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> ValueType&gt;</div>
<div class="line">  <span class="keyword">inline</span> FieldEntry&lt;ValueType&gt;&amp;</div>
<div class="line">  DECLARE(ParamManagerSingleton&lt;MyParam&gt; *manager,</div>
<div class="line">          <span class="keyword">const</span> std::string&amp; key,</div>
<div class="line">          ValueType&amp; ref){</div>
<div class="line">    <span class="comment">// offset gives a generic way to access the address of the field</span></div>
<div class="line">    <span class="comment">// from beginning of the structure.</span></div>
<div class="line">    <span class="keywordtype">size_t</span> offset = ((<span class="keywordtype">char</span>*)&amp;ref - (<span class="keywordtype">char</span>*)<span class="keyword">this</span>);</div>
<div class="line">    parameter::FieldEntry&lt;ValueType&gt; *e =</div>
<div class="line">        <span class="keyword">new</span> parameter::FieldEntry&lt;ValueType&gt;(key, offset);</div>
<div class="line">    manager-&gt;AddEntry(key, e);</div>
<div class="line">    <span class="keywordflow">return</span> *e;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structMyParam.html">MyParam</a> : <span class="keyword">public</span> dmlc::Parameter&lt;MyParam&gt; {</div>
<div class="line">  <span class="keywordtype">float</span> learning_rate;</div>
<div class="line">  <span class="keywordtype">int</span> num_hidden;</div>
<div class="line">  <span class="comment">// declare parameters</span></div>
<div class="line">  <span class="keyword">inline</span> <span class="keywordtype">void</span> __DECLARE__(ParamManagerSingleton&lt;MyParam&gt; *manager) {</div>
<div class="line">    this-&gt;DECLARE(manager, <span class="stringliteral">&quot;num_hidden&quot;</span>, num_hidden);</div>
<div class="line">    this-&gt;DECLARE(manager, <span class="stringliteral">&quot;learning_rate&quot;</span>, learning_rate).set_default(0.01f);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This code is only used to show the general idea.</span></div>
<div class="line"><span class="comment">// This code will only run once, the real code is done via singleton declaration pattern.</span></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">static</span> ParamManagerSingleton&lt;MyParam&gt; manager;</div>
<div class="line">  <a class="code hl_struct" href="structMyParam.html">MyParam</a> tmp;</div>
<div class="line">  tmp-&gt;__DECLARE__(&amp;manager);</div>
<div class="line">}</div>
</div><!-- fragment --><p> This is not the actual code that runs, but generally shows the idea on how it works. The key is that the structure layout is fixed for all the instances of objects. To figure out how to access each of the field, we can</p><ul>
<li>Create an instance of <a class="el" href="structMyParam.html">MyParam</a>, call the <code>__DECLARE__</code> function.</li>
<li>The relative position of the field against the head of the structure is recorded into a global singleton.</li>
<li>When we call <code>Init</code>, we can get the <code>offset</code> from the singleton, and access the address of the field via <code>(ValueType*)((char*)this + offset)</code>.</li>
</ul>
<p>You are welcomed to check out the real details in <a href="https://github.com/dmlc/dmlc-core/blob/main/include/dmlc/parameter.h">dmlc/parameter.h</a>. By using the generic template programming in C++, we have created a simple and useful parameter module for machine learning libraries. This module is used extensively by DMLC projects. Hope you will find it useful as well :). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 10 2025 11:34:47 for Medial Code Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
